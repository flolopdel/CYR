<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva: Lluvia de alb√≥ndigas (Scratch)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap');
        body { font-family: 'Nunito', sans-serif; background-color: #FDFBF7; color: #4A5568; }
        .scratch-block {
            background-color: #FFBF00; /* Events */
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 4px;
            font-weight: bold;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
            cursor: default;
        }
        .scratch-motion { background-color: #4C97FF; }
        .scratch-control { background-color: #FFAB19; }
        .scratch-variable { background-color: #FF8C1A; }
        .scratch-operator { background-color: #59C059; }
        .scratch-sensing { background-color: #5CB1D6; }
        .scratch-looks { background-color: #9966FF; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }

        .sim-canvas {
            border: 2px solid #E2E8F0;
            border-radius: 0.5rem;
            background-color: #EDF2F7;
            margin: 0 auto;
            display: block;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0aec0; }
    </style>
    <!-- Chosen Palette: Warm Neutrals with Soft Accents (Purple/Green/Orange) to match a playful yet educational tone -->
    <!-- Application Structure Plan:
         1. Hero Section: Context setting based on the Source Report (Avalanche history).
         2. Simulation Lab: The core feature. A live HTML5 Canvas version of the game described in the text, paired with Chart.js analytics to visualize the 'Variables' (Score vs Speed) mentioned in the report. This proves the logic works.
         3. Logic Deconstruction: An interactive tabbed interface to break down the specific Scratch blocks for Catcher vs Food, as detailed in the guide.
         4. Asset & Setup Manager: A visual checklist for the initial configuration (size 50%, 5 items).
         5. Challenge Board: Interactive suggestions for the "Retos" mentioned in the PDF.
         Designed to move from "Experience" (Sim) to "Understanding" (Logic) to "Creation" (Setup).
    -->
</head>
<body class="antialiased min-h-screen flex flex-col">

    <!-- Navigation / Header -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl mr-2">üè∞</span>
                    <h1 class="text-xl font-bold text-gray-800">Scratch Lab: Lluvia de alb√≥ndigas</h1>
                </div>
                <div class="hidden sm:flex items-center space-x-4">
                    <button onclick="scrollToSection('simulation')" class="text-gray-600 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">Simulaci√≥n</button>
                    <button onclick="scrollToSection('logic')" class="text-gray-600 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">L√≥gica de Bloques</button>
                    <button onclick="scrollToSection('setup')" class="text-gray-600 hover:text-purple-600 px-3 py-2 rounded-md text-sm font-medium">Configuraci√≥n</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Intro -->
    <section class="bg-purple-50 border-b border-purple-100 py-10 px-4">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-4">Dise√±ando un cl√°sico "Avalanche"</h2>
            <p class="text-lg text-gray-600 mb-6">
                Basado en la gu√≠a original, este panel interactivo desglosa la mec√°nica del juego: 
                <span class="font-semibold text-purple-700">recoger objetos</span>, 
                gestionar <span class="font-semibold text-orange-600">variables</span> y 
                aumentar la <span class="font-semibold text-red-600">dificultad</span> progresivamente.
            </p>
            <div class="flex justify-center gap-4 flex-wrap">
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 w-40">
                    <div class="text-2xl mb-1">üçé</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide">Objetivo</div>
                    <div class="font-bold text-gray-700">Atrapar Comida</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 w-40">
                    <div class="text-2xl mb-1">üìâ</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide">Mec√°nica</div>
                    <div class="font-bold text-gray-700">Gravedad Variable</div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-100 w-40">
                    <div class="text-2xl mb-1">üß±</div>
                    <div class="text-xs text-gray-500 uppercase tracking-wide">Plataforma</div>
                    <div class="font-bold text-gray-700">Scratch</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- Simulation Section -->
        <section id="simulation" class="mb-16 scroll-mt-20">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">1</span>
                    Laboratorio de Simulaci√≥n y Datos
                </h3>
                <p class="text-gray-600 mt-2">
                    Experimenta con la l√≥gica del juego en tiempo real. Observa c√≥mo interact√∫an las variables 
                    <code>puntos</code> y <code>velocidad</code> tal como se describe en la gu√≠a. Usa las flechas ‚¨ÖÔ∏è ‚û°Ô∏è para mover la "cesta".
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Game Canvas -->
                <div class="bg-white p-4 rounded-xl shadow-md border border-gray-200 flex flex-col items-center">
                    <div class="w-full flex justify-between items-center mb-4">
                        <div class="flex gap-4 text-sm font-bold">
                            <div class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">Puntos: <span id="scoreDisplay">0</span></div>
                            <div class="bg-red-100 text-red-800 px-3 py-1 rounded-full">Velocidad Y: <span id="speedDisplay">-5</span></div>
                        </div>
                        <button id="toggleGameBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-1 rounded shadow text-sm transition-colors">
                            Iniciar Simulaci√≥n
                        </button>
                    </div>
                    <canvas id="gameCanvas" width="400" height="300" class="sim-canvas w-full max-w-[400px]"></canvas>
                    <p class="text-xs text-gray-400 mt-2">Controles: Flechas izquierda/derecha o tocar lados de la pantalla.</p>
                </div>

                <!-- Live Charts -->
                <div class="bg-white p-4 rounded-xl shadow-md border border-gray-200">
                    <h4 class="font-bold text-gray-700 mb-2 border-b pb-2">An√°lisis de Variables en Tiempo Real</h4>
                    
                    <div class="mb-6">
                        <p class="text-xs text-gray-500 mb-1">Progresi√≥n de Puntos (Acumulativo)</p>
                        <!-- Chart Container for Score -->
                        <div class="chart-container">
                            <canvas id="scoreChart"></canvas>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-xs text-gray-500 mb-1">Aumento de Dificultad (Velocidad de Ca√≠da)</p>
                        <!-- Chart Container for Speed -->
                        <div class="chart-container h-40 max-h-48">
                            <canvas id="speedChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Insight Block -->
            <div class="mt-6 bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <span class="text-xl">üí°</span>
                    </div>
                    <div class="ml-3">
                        <h3 class="text-sm font-bold text-blue-800">La l√≥gica detr√°s de la simulaci√≥n</h3>
                        <p class="text-sm text-blue-700 mt-1">
                            Como indica la gu√≠a, cada vez que tocas un objeto:
                            1. Sumamos <strong>10 puntos</strong>.
                            2. Restamos <strong>-0.5</strong> a la velocidad (haci√©ndola m√°s r√°pida hacia abajo).
                            Esta retroalimentaci√≥n crea la curva de dificultad que ves en los gr√°ficos.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Logic Breakdown Section -->
        <section id="logic" class="mb-16 scroll-mt-20">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">2</span>
                    Arquitectura del C√≥digo
                </h3>
                <p class="text-gray-600 mt-2">
                    Selecciona un actor para ver c√≥mo se traduce la gu√≠a en bloques l√≥gicos. Esta estructura es la columna vertebral de tu juego.
                </p>
            </div>

            <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
                <!-- Tabs -->
                <div class="flex border-b border-gray-200 bg-gray-50">
                    <button class="tab-btn px-6 py-4 text-sm font-medium text-purple-600 border-b-2 border-purple-600 focus:outline-none bg-white" onclick="switchTab('catcher')">
                        üë∏ El Personaje (Catcher)
                    </button>
                    <button class="tab-btn px-6 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none" onclick="switchTab('food')">
                        üçé La Comida (Objetos)
                    </button>
                    <button class="tab-btn px-6 py-4 text-sm font-medium text-gray-500 hover:text-gray-700 focus:outline-none" onclick="switchTab('init')">
                        üèÅ Inicializaci√≥n
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="p-6 min-h-[400px]">
                    
                    <!-- Catcher Content -->
                    <div id="content-catcher" class="tab-content block">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-bold text-gray-800 mb-3">Movimiento Horizontal</h4>
                                <p class="text-sm text-gray-600 mb-4">
                                    El personaje debe seguir al rat√≥n o responder al teclado. La gu√≠a sugiere actualizar la posici√≥n X constantemente.
                                </p>
                                <div class="bg-gray-100 p-4 rounded-lg font-mono text-sm border border-gray-300">
                                    <div class="scratch-block scratch-events">al presionar üö©</div>
                                    <div class="scratch-block scratch-control">por siempre</div>
                                    <div class="pl-4 border-l-2 border-gray-300 ml-2">
                                        <div class="scratch-block scratch-motion">dar a x el valor (posici√≥n x del rat√≥n)</div>
                                        <div class="text-gray-500 italic py-1">// Opcional: controles de teclado</div>
                                        <div class="scratch-block scratch-control">si (tecla flecha derecha presionada?) entonces</div>
                                        <div class="pl-4 border-l-2 border-gray-300 ml-2">
                                            <div class="scratch-block scratch-motion">sumar a x (10)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col justify-center items-center bg-purple-50 rounded-lg p-6">
                                <div class="text-4xl mb-4">üë∏</div>
                                <p class="text-center text-sm font-medium text-purple-800">
                                    El "Catcher" es el ancla del jugador.<br>
                                    Debe estar siempre en la parte inferior (Y fijo).
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Food Content -->
                    <div id="content-food" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-bold text-gray-800 mb-3">El Bucle de Ca√≠da</h4>
                                <p class="text-sm text-gray-600 mb-4">
                                    Esta es la l√≥gica compleja. Controla la aparici√≥n, ca√≠da, colisi√≥n y reinicio.
                                </p>
                                <div class="bg-gray-100 p-4 rounded-lg font-mono text-sm border border-gray-300 h-96 overflow-y-auto">
                                    <div class="scratch-block scratch-control">por siempre</div>
                                    <div class="pl-4 border-l-2 border-gray-300 ml-2">
                                        <div class="scratch-block scratch-motion">ir a x: (aleatorio -200 a 200) y: 180</div>
                                        <div class="scratch-block scratch-looks">mostrar</div>
                                        <div class="scratch-block scratch-control">repetir hasta que (¬øtocando borde? o ¬øtocando Catcher?)</div>
                                        <div class="pl-4 border-l-2 border-gray-300 ml-2">
                                            <div class="scratch-block scratch-motion">sumar a y (velocidad)</div>
                                        </div>
                                        <div class="scratch-block scratch-control">si (¬øtocando Catcher?) entonces</div>
                                        <div class="pl-4 border-l-2 border-gray-300 ml-2">
                                            <div class="scratch-block scratch-variable">sumar a [puntos] (10)</div>
                                            <div class="scratch-block scratch-variable">sumar a [velocidad] (-0.5)</div>
                                            <div class="scratch-block scratch-sound">tocar sonido [Chomp]</div>
                                        </div>
                                        <div class="scratch-block scratch-looks">esconder</div>
                                        <div class="scratch-block scratch-control">esperar (aleatorio 1 a 3) segundos</div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-lg font-bold text-gray-800 mb-3">Puntos Clave</h4>
                                <ul class="space-y-3">
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úî</span>
                                        <span class="text-sm text-gray-700"><strong>Aleatoriedad:</strong> La posici√≥n X y el tiempo de espera var√≠an para que no sea predecible.</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úî</span>
                                        <span class="text-sm text-gray-700"><strong>Colisi√≥n:</strong> Verificamos dos cosas: si toc√≥ el suelo (borde) o si lo atrapamos.</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-green-500 mr-2">‚úî</span>
                                        <span class="text-sm text-gray-700"><strong>Feedback:</strong> El sonido y el cambio de variable dan respuesta inmediata al jugador.</span>
                                    </li>
                                </ul>
                                <div class="mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                                    <p class="text-xs text-orange-800 font-bold">RETO DEL DOCUMENTO:</p>
                                    <p class="text-sm text-orange-700 mt-1">
                                        "¬øA√±adir elemento abajo?"<br>
                                        Si la comida toca el borde y NO al personaje, podr√≠as restar vidas. ¬°A√±ade un bloque <code>si tocando borde entonces restar vida</code> dentro del bucle!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Init Content -->
                    <div id="content-init" class="tab-content hidden">
                        <div class="flex flex-col space-y-4">
                            <h4 class="text-lg font-bold text-gray-800">Preparaci√≥n del Escenario</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="p-4 bg-white border rounded-lg shadow-sm">
                                    <div class="scratch-block scratch-events">al presionar üö©</div>
                                    <div class="scratch-block scratch-looks">esconder</div>
                                    <div class="scratch-block scratch-control">esperar (3) segundos</div>
                                    <div class="scratch-block scratch-variable">dar a [puntos] el valor (0)</div>
                                    <div class="scratch-block scratch-variable">dar a [velocidad] el valor (-5)</div>
                                </div>
                                <div class="flex flex-col justify-center text-sm text-gray-600">
                                    <p class="mb-2"><strong>¬øPor qu√© esconder?</strong> Para que no aparezcan todos los objetos de golpe en la pantalla.</p>
                                    <p class="mb-2"><strong>¬øPor qu√© esperar?</strong> Da tiempo al jugador a prepararse.</p>
                                    <p><strong>Reinicio:</strong> Siempre resetea las variables al inicio para que el juego sea justo.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Setup & Assets Section -->
        <section id="setup" class="mb-16 scroll-mt-20">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="bg-purple-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-sm mr-3">3</span>
                    Lista de Configuraci√≥n
                </h3>
                <p class="text-gray-600 mt-2">
                    Aseg√∫rate de tener estos elementos listos antes de empezar a programar.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Asset Card 1 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center">
                    <div class="text-4xl mb-3">üèûÔ∏è</div>
                    <h4 class="font-bold text-gray-800">El Fondo</h4>
                    <p class="text-sm text-gray-500 mt-1">Un castillo o paisaje exterior.</p>
                    <div class="mt-4 inline-block px-3 py-1 bg-gray-100 text-xs font-semibold rounded text-gray-600">Est√°tico</div>
                </div>

                <!-- Asset Card 2 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 font-bold">CR√çTICO</div>
                    <div class="text-4xl mb-3">üë∏</div>
                    <h4 class="font-bold text-gray-800">Personaje Principal</h4>
                    <p class="text-sm text-gray-500 mt-1">Princesa, Cesta o Cuenco.</p>
                    <div class="mt-4 inline-block px-3 py-1 bg-red-100 text-xs font-semibold rounded text-red-600">Tama√±o: 50%</div>
                </div>

                <!-- Asset Card 3 -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 text-center relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 font-bold">X 5</div>
                    <div class="text-4xl mb-3">üç©üçéüçå</div>
                    <h4 class="font-bold text-gray-800">Comida</h4>
                    <p class="text-sm text-gray-500 mt-1">5 Objetos diferentes.</p>
                    <div class="mt-4 inline-block px-3 py-1 bg-red-100 text-xs font-semibold rounded text-red-600">Tama√±o: 50%</div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-gray-200 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">
                Generado a partir de la gu√≠a "princesa y castillo.pdf" | Dise√±o de App Interactiva
            </p>
            <p class="text-gray-400 text-xs mt-2">
                Utiliza Chart.js para visualizaci√≥n de datos y Vanilla JS para simulaci√≥n l√≥gica.
            </p>
        </div>
    </footer>

    <script>
        // --- 1. Logic Visualization Tabs ---
        function switchTab(tabId) {
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('block'));
            
            // Reset button styles
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-purple-600', 'border-b-2', 'border-purple-600', 'bg-white');
                btn.classList.add('text-gray-500');
            });

            // Show selected content
            document.getElementById('content-' + tabId).classList.remove('hidden');
            document.getElementById('content-' + tabId).classList.add('block');

            // Highlight selected button
            const activeBtn = document.querySelector(`button[onclick="switchTab('${tabId}')"]`);
            activeBtn.classList.remove('text-gray-500');
            activeBtn.classList.add('text-purple-600', 'border-b-2', 'border-purple-600', 'bg-white');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- 2. Game Simulation Logic (The Core Interaction) ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const speedDisplay = document.getElementById('speedDisplay');
        const toggleBtn = document.getElementById('toggleGameBtn');

        // Game State
        let gameState = {
            isPlaying: false,
            score: 0,
            velocity: -5, // Start speed as per guide
            catcherX: 200,
            catcherY: 270,
            catcherWidth: 40,
            catcherHeight: 20,
            foods: [],
            lastTime: 0,
            spawnTimer: 0,
            historyScore: [],
            historySpeed: []
        };

        // Food Object Class
        class Food {
            constructor() {
                this.reset();
                this.delay = Math.random() * 2000; // Random start delay
            }

            reset() {
                this.x = Math.random() * (canvas.width - 20) + 10;
                this.y = -20; // Start above screen
                this.active = false;
                this.delay = Math.random() * 2000 + 500; // Wait 0.5-2.5s before showing
                this.color = ['#F6E05E', '#F56565', '#ED8936', '#48BB78'][Math.floor(Math.random()*4)];
                this.symbol = ['üç©', 'üçé', 'üçå', 'üç∞'][Math.floor(Math.random()*4)];
            }

            update(dt) {
                if (this.delay > 0) {
                    this.delay -= dt;
                    return;
                }
                
                this.active = true;
                // Move down by velocity (inverted because canvas Y goes down)
                // Guide says velocity is negative (-5), so we subtract it to go down?
                // Actually in Scratch Y goes UP. In Canvas Y goes DOWN.
                // So velocity -5 in Scratch means DOWN. In Canvas we ADD positive 5.
                // To keep visualization true to guide numbers, we'll store negative but apply abs.
                this.y += Math.abs(gameState.velocity) * (dt / 16); 

                // Check collision with catcher
                if (
                    this.x > gameState.catcherX - 20 &&
                    this.x < gameState.catcherX + gameState.catcherWidth + 20 &&
                    this.y > gameState.catcherY &&
                    this.y < gameState.catcherY + gameState.catcherHeight
                ) {
                    // CAUGHT!
                    gameState.score += 10;
                    gameState.velocity -= 0.5; // Make it faster (more negative)
                    updateCharts();
                    this.reset();
                }

                // Check collision with bottom border
                if (this.y > canvas.height) {
                    this.reset();
                }
            }

            draw(ctx) {
                if (!this.active) return;
                ctx.font = "20px Arial";
                ctx.fillText(this.symbol, this.x, this.y);
            }
        }

        // Initialize Foods
        for(let i=0; i<3; i++) { // Start with 3 items for demo
            gameState.foods.push(new Food());
        }

        // Input Handling
        let keys = {};
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Touch handling for mobile
        canvas.addEventListener('touchstart', handleTouch, false);
        canvas.addEventListener('touchmove', handleTouch, false);

        function handleTouch(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const touchX = touch.clientX - rect.left;
            
            // Map touch X to catcher position
            // Keep catcher within bounds
            gameState.catcherX = Math.max(0, Math.min(canvas.width - gameState.catcherWidth, touchX - gameState.catcherWidth/2));
        }

        // --- 3. Visualization (Chart.js) ---
        // Visualization & Content Choices:
        // Goal: Inform & Change. Show how the game gets harder (Speed) and rewarding (Score).
        // Viz: Line Charts. 
        // Justification: Line charts are best for showing trends over time/events.
        // Interaction: Charts update automatically as the game is played.
        
        let scoreChartCtx = document.getElementById('scoreChart').getContext('2d');
        let speedChartCtx = document.getElementById('speedChart').getContext('2d');

        let scoreChart = new Chart(scoreChartCtx, {
            type: 'line',
            data: {
                labels: ['Start'],
                datasets: [{
                    label: 'Puntos Totales',
                    data: [0],
                    borderColor: '#805AD5',
                    backgroundColor: 'rgba(128, 90, 213, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });

        let speedChart = new Chart(speedChartCtx, {
            type: 'line',
            data: {
                labels: ['Start'],
                datasets: [{
                    label: 'Velocidad (Valor Absoluto)',
                    data: [5],
                    borderColor: '#F56565',
                    backgroundColor: 'rgba(245, 101, 101, 0.1)',
                    fill: true,
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: false } }
            }
        });

        function updateCharts() {
            const label = gameState.score / 10; // Simple step counter
            
            scoreChart.data.labels.push(label);
            scoreChart.data.datasets[0].data.push(gameState.score);
            if(scoreChart.data.labels.length > 10) {
                scoreChart.data.labels.shift();
                scoreChart.data.datasets[0].data.shift();
            }
            scoreChart.update();

            speedChart.data.labels.push(label);
            speedChart.data.datasets[0].data.push(Math.abs(gameState.velocity));
             if(speedChart.data.labels.length > 10) {
                speedChart.data.labels.shift();
                speedChart.data.datasets[0].data.shift();
            }
            speedChart.update();
        }

        // --- Game Loop ---
        function loop(timestamp) {
            if (!gameState.isPlaying) return;
            const dt = timestamp - gameState.lastTime;
            gameState.lastTime = timestamp;

            // Clear
            ctx.fillStyle = '#EDF2F7';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Move Catcher
            if (keys['ArrowRight']) gameState.catcherX += 5;
            if (keys['ArrowLeft']) gameState.catcherX -= 5;
            
            // Clamp Catcher
            if (gameState.catcherX < 0) gameState.catcherX = 0;
            if (gameState.catcherX > canvas.width - gameState.catcherWidth) gameState.catcherX = canvas.width - gameState.catcherWidth;

            // Draw Catcher
            ctx.font = "30px Arial";
            ctx.fillText("üë∏", gameState.catcherX, gameState.catcherY + 20);

            // Update & Draw Foods
            gameState.foods.forEach(food => {
                food.update(dt);
                food.draw(ctx);
            });

            // Update UI Stats
            scoreDisplay.innerText = gameState.score;
            speedDisplay.innerText = gameState.velocity.toFixed(1);

            requestAnimationFrame(loop);
        }

        toggleBtn.addEventListener('click', () => {
            if (gameState.isPlaying) {
                gameState.isPlaying = false;
                toggleBtn.innerText = "Reanudar Simulaci√≥n";
                toggleBtn.classList.replace('bg-red-600', 'bg-purple-600');
                toggleBtn.classList.replace('hover:bg-red-700', 'hover:bg-purple-700');
            } else {
                gameState.isPlaying = true;
                gameState.lastTime = performance.now();
                requestAnimationFrame(loop);
                toggleBtn.innerText = "Pausar Simulaci√≥n";
                toggleBtn.classList.replace('bg-purple-600', 'bg-red-600');
                toggleBtn.classList.replace('hover:bg-purple-700', 'hover:bg-red-700');
            }
        });

        // Initial Draw
        ctx.fillStyle = '#EDF2F7';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.font = "30px Arial";
        ctx.fillText("üë∏", gameState.catcherX, gameState.catcherY + 20);
        ctx.font = "14px Arial";
        ctx.fillStyle = "#A0AEC0";
        ctx.fillText("Pulsa 'Iniciar' para jugar", 110, 150);

    </script>
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</body>
</html>