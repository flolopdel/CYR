<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva: L√≥gica de Juego en Scratch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Scratch-like Block Styling */
        .scratch-block {
            padding: 8px 12px;
            border-radius: 4px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
            display: inline-block;
            box-shadow: 0 2px 0 rgba(0,0,0,0.2);
            cursor: default;
        }
        .block-event { background-color: #FFBF00; border: 1px solid #cc9900; }
        .block-control { background-color: #FFAB19; border: 1px solid #cf8b17; }
        .block-motion { background-color: #4C97FF; border: 1px solid #3373cc; }
        .block-variable { background-color: #FF8C1A; border: 1px solid #db7916; }
        .block-looks { background-color: #9966FF; border: 1px solid #774dcB; }
        .block-sensing { background-color: #5CB1D6; border: 1px solid #2E8EB8; }
        
        /* Nesting for blocks */
        .block-nest {
            border-left: 3px solid rgba(0,0,0,0.2);
            padding-left: 8px;
            margin-left: 4px;
            margin-top: 2px;
            margin-bottom: 2px;
        }

        /* Chart Container Specifics per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Explicit max-width */
            margin-left: auto;
            margin-right: auto;
            height: 250px;
            max-height: 300px;
        }
    </style>
    <!-- Chosen Palette: Warm Neutrals & Scratch Accents (Interpreting "Warm Neutrals" base with functional color coding from Scratch domain) -->
    <!-- Application Structure Plan:
         1. Hero Section: Sets the context of the tutorial.
         2. Interactive Workbench (Split Layout):
            - Left Column: Step-by-Step Logic Explorer. Users toggle between steps (Movement, Jump, Obstacle) to see the code structure.
            - Right Column: Live Simulation & Analytics. 
              - Top: A Canvas implementing the game logic described in the source.
              - Bottom: A Chart.js Line chart visualizing the 'Y Velocity' physics to explain the math behind the code.
         3. Analysis Section: Tips and tricks presented as interactive cards.
         Rationale: This structure separates the "Instruction" (Code) from the "Result" (Simulation), allowing the user to read the guide while simultaneously seeing the code execute and analyzing the physics data, reinforcing the learning process.
    -->
    <!-- Visualization & Content Choices:
         1. Canvas Game Simulation: 
            - Goal: Inform/Change. 
            - Method: HTML5 Canvas. 
            - Logic: Replicates the Scratch logic (x += 10, y velocity loop) in JS.
            - Justification: The user needs to see the result of the instructions.
         2. Physics Analysis Chart (Chart.js): 
            - Goal: Inform/Relationships. 
            - Method: Line Chart. 
            - Interaction: Updates in real-time when the character jumps.
            - Justification: Visualizes Step 1B (Gravity/Parabola) to explain *why* we subtract -1.5 from velocity.
         3. Logic Block Builder (HTML/CSS):
            - Goal: Organize/Inform.
            - Method: Styled Divs (No SVG).
            - Interaction: Click to highlight explanation.
            - Justification: Translates text-based instructions into visual "blocks" familiar to Scratch users.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-50 text-stone-800 selection:bg-orange-200">

    <!-- Header -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <h1 class="text-xl font-bold text-stone-800 flex items-center gap-2">
                <span class="text-2xl">üê±</span> Laboratorio de L√≥gica Scratch
            </h1>
            <nav class="hidden md:flex space-x-6">
                <button onclick="scrollToSection('intro')" class="text-stone-500 hover:text-orange-600 transition-colors">Inicio</button>
                <button onclick="scrollToSection('workbench')" class="text-stone-500 hover:text-orange-600 transition-colors">Taller Interactivo</button>
                <button onclick="scrollToSection('tips')" class="text-stone-500 hover:text-orange-600 transition-colors">Mejoras</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">

        <!-- Introduction -->
        <section id="intro" class="text-center max-w-3xl mx-auto">
            <h2 class="text-3xl font-bold text-stone-900 mb-4">Tu Primer Juego de Plataformas</h2>
            <p class="text-lg text-stone-600 leading-relaxed">
                Esta aplicaci√≥n interactiva transforma la gu√≠a de texto en un laboratorio funcional. 
                Aqu√≠ podr√°s ver c√≥mo las instrucciones paso a paso se convierten en c√≥digo real, 
                visualizar la f√≠sica detr√°s del salto y probar la l√≥gica del juego en tiempo real.
                Analiza los bloques, observa los datos y ¬°evita el obst√°culo!
            </p>
        </section>

        <!-- Workbench Area: Split View -->
        <section id="workbench" class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
            
            <!-- Left Column: Step-by-Step Instructions -->
            <div class="lg:col-span-5 space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <h3 class="text-lg font-bold text-stone-800 mb-2 border-b border-stone-100 pb-2">Gu√≠a de Programaci√≥n</h3>
                    <p class="text-sm text-stone-500 mb-4">
                        Selecciona un paso para ver los bloques l√≥gicos necesarios. El simulador a la derecha ejecutar√° este c√≥digo.
                    </p>

                    <!-- Steps Navigation -->
                    <div class="flex space-x-2 mb-6 overflow-x-auto pb-2">
                        <button onclick="setStep(1)" id="btn-step-1" class="px-4 py-2 rounded-full text-sm font-semibold bg-orange-500 text-white shadow-md transition-all whitespace-nowrap">Paso 1: Movimiento</button>
                        <button onclick="setStep(2)" id="btn-step-2" class="px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 hover:bg-stone-300 transition-all whitespace-nowrap">Paso 2: Obst√°culos</button>
                    </div>

                    <!-- Dynamic Content Container -->
                    <div id="instruction-content" class="space-y-4">
                        <!-- Content injected by JS -->
                    </div>
                </div>

                <!-- Explanation Box -->
                <div class="bg-orange-50 rounded-xl border border-orange-100 p-5">
                    <h4 class="font-bold text-orange-800 flex items-center gap-2">
                        <span>üí°</span> ¬øPor qu√© funciona as√≠?
                    </h4>
                    <p id="logic-explanation" class="text-sm text-orange-900 mt-2 leading-relaxed">
                        Selecciona un paso arriba para ver la explicaci√≥n l√≥gica.
                    </p>
                </div>
            </div>

            <!-- Right Column: Simulation & Data Viz -->
            <div class="lg:col-span-7 space-y-6">
                
                <!-- Game Canvas -->
                <div class="bg-stone-900 rounded-xl shadow-lg overflow-hidden relative">
                    <div class="absolute top-4 left-4 z-10 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
                        Simulaci√≥n en Tiempo Real
                    </div>
                    <div class="absolute top-4 right-4 z-10 flex gap-2">
                         <button onclick="resetGame()" class="bg-white/10 hover:bg-white/20 text-white text-xs px-3 py-1 rounded backdrop-blur-sm transition-colors border border-white/20">üîÑ Reiniciar</button>
                    </div>
                    
                    <!-- Canvas Container -->
                    <div class="w-full h-80 flex items-center justify-center bg-stone-800" id="game-container">
                        <canvas id="gameCanvas" width="600" height="320" class="max-w-full h-full object-contain"></canvas>
                    </div>

                    <!-- Controls Hint -->
                    <div class="bg-stone-800 px-4 py-2 flex justify-between items-center border-t border-stone-700">
                        <div class="flex gap-4 text-xs text-stone-400">
                            <span class="flex items-center gap-1"><span class="bg-stone-700 px-1 rounded">‚Üê</span> <span class="bg-stone-700 px-1 rounded">‚Üí</span> Mover</span>
                            <span class="flex items-center gap-1"><span class="bg-stone-700 px-1.5 rounded">Espacio</span> Saltar</span>
                        </div>
                        <div class="text-xs font-mono text-orange-400" id="score-display">Puntos: 0</div>
                    </div>
                </div>

                <!-- Data Analysis Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-200 p-6">
                    <div class="mb-4">
                        <h3 class="text-base font-bold text-stone-800">An√°lisis de F√≠sica: Curva de Salto</h3>
                        <p class="text-xs text-stone-500">
                            Visualizaci√≥n de la variable <span class="font-mono bg-stone-100 px-1 rounded">velocidad Y</span> en tiempo real. Observa la par√°bola creada por la gravedad (-1.5).
                        </p>
                    </div>
                    
                    <!-- Chart Container (Strictly Constrained) -->
                    <div class="chart-container">
                        <canvas id="physicsChart"></canvas>
                    </div>
                </div>

            </div>
        </section>

        <!-- Tips Section -->
        <section id="tips" class="py-8">
            <div class="mb-6">
                <h3 class="text-2xl font-bold text-stone-800">Mejoras y Desaf√≠os</h3>
                <p class="text-stone-600 max-w-2xl">
                    Una vez domines la l√≥gica b√°sica, utiliza estas ideas del reporte fuente para expandir tu juego.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Tip 1 -->
                <div class="group bg-white p-6 rounded-xl shadow-sm border border-stone-200 hover:border-orange-300 transition-all cursor-pointer">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl mb-4 group-hover:scale-110 transition-transform">üé®</div>
                    <h4 class="font-bold text-stone-800 mb-2">Disfraces y Animaci√≥n</h4>
                    <p class="text-sm text-stone-600">
                        Cambia el disfraz del personaje mientras se mueve para simular que corre. Usa el bloque "siguiente disfraz".
                    </p>
                </div>

                <!-- Tip 2 -->
                <div class="group bg-white p-6 rounded-xl shadow-sm border border-stone-200 hover:border-orange-300 transition-all cursor-pointer">
                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-xl mb-4 group-hover:scale-110 transition-transform">üèÜ</div>
                    <h4 class="font-bold text-stone-800 mb-2">Sistema de Puntuaci√≥n</h4>
                    <p class="text-sm text-stone-600">
                        Crea una variable "Puntos". Suma 1 cada vez que el obst√°culo llegue al borde izquierdo (x < -230).
                    </p>
                </div>

                <!-- Tip 3 -->
                <div class="group bg-white p-6 rounded-xl shadow-sm border border-stone-200 hover:border-orange-300 transition-all cursor-pointer">
                    <div class="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center text-xl mb-4 group-hover:scale-110 transition-transform">‚õî</div>
                    <h4 class="font-bold text-stone-800 mb-2">Suelo Seguro</h4>
                    <p class="text-sm text-stone-600">
                        Usa "¬øtocando color?" para detectar el suelo, permitiendo plataformas a diferentes alturas.
                    </p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-100 border-t border-stone-200 py-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 text-center text-stone-500 text-sm">
            <p>Generado a partir de la gu√≠a "Mi Primer Juego en Scratch". Implementaci√≥n en Canvas y Tailwind.</p>
        </div>
    </footer>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA & CONTENT ---
        const tutorialData = {
            1: {
                title: "Paso 1: Movimiento y Gravedad",
                content: `
                    <div class="space-y-4">
                        <div>
                            <h5 class="font-bold text-sm text-stone-700 mb-2">A. Evento Inicial</h5>
                            <div class="scratch-block block-event">al presionar bandera verde üö©</div>
                            <div class="block-nest">
                                <div class="scratch-block block-control">por siempre üîÑ</div>
                                <div class="block-nest">
                                    <div class="scratch-block block-control">si &lt;tecla derecha&gt; entonces</div>
                                    <div class="block-nest"><div class="scratch-block block-motion">sumar a x: 10</div></div>
                                    <div class="scratch-block block-control">si &lt;tecla izquierda&gt; entonces</div>
                                    <div class="block-nest"><div class="scratch-block block-motion">sumar a x: -10</div></div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-bold text-sm text-stone-700 mb-2">B. L√≥gica de Salto (Gravedad)</h5>
                            <div class="scratch-block block-control">si &lt;tecla espacio&gt; entonces</div>
                            <div class="block-nest">
                                <div class="scratch-block block-variable">dar a velocidad Y el valor 15</div>
                                <div class="scratch-block block-control">repetir 10 veces</div>
                                <div class="block-nest">
                                    <div class="scratch-block block-motion">sumar a y: velocidad Y</div>
                                    <div class="scratch-block block-variable">sumar a velocidad Y: -1.5</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                explanation: "Para el movimiento horizontal, simplemente sumamos o restamos valor a la coordenada X. El salto es m√°s complejo: usamos una variable 'velocidad Y' que empieza fuerte (15) y disminuye gradualmente (-1.5) en cada repetici√≥n. Esto crea una curva parab√≥lica natural en lugar de un movimiento rob√≥tico de arriba-abajo."
            },
            2: {
                title: "Paso 2: Obst√°culos y Colisiones",
                content: `
                    <div class="space-y-4">
                        <div>
                            <h5 class="font-bold text-sm text-stone-700 mb-2">A. El Enemigo</h5>
                            <div class="scratch-block block-event">al presionar bandera verde üö©</div>
                            <div class="block-nest">
                                <div class="scratch-block block-control">por siempre üîÑ</div>
                                <div class="block-nest">
                                    <div class="scratch-block block-motion">ir a x: 240 y: -130</div>
                                    <div class="scratch-block block-motion">deslizar en 2 seg a x: -240 y: -130</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="font-bold text-sm text-stone-700 mb-2">B. Game Over</h5>
                            <div class="scratch-block block-control">si &lt;tocando Obst√°culo&gt; entonces</div>
                            <div class="block-nest">
                                <div class="scratch-block block-looks">decir "¬°Perd√≠!"</div>
                                <div class="scratch-block block-control">detener todos</div>
                            </div>
                        </div>
                    </div>
                `,
                explanation: "El obst√°culo usa un bucle infinito para moverse de derecha (x: 240) a izquierda (x: -240). La colisi√≥n se detecta calculando la distancia entre el jugador y el obst√°culo. Si se tocan, detenemos el juego."
            }
        };

        // --- APP STATE ---
        let currentStep = 1;
        let gameActive = true;
        let score = 0;
        
        // --- CHART JS SETUP ---
        const ctxChart = document.getElementById('physicsChart').getContext('2d');
        const physicsChart = new Chart(ctxChart, {
            type: 'line',
            data: {
                labels: Array(20).fill(''),
                datasets: [{
                    label: 'Posici√≥n Y (Altura)',
                    data: Array(20).fill(0),
                    borderColor: 'rgb(249, 115, 22)', // Orange-500
                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                    borderWidth: 2,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 150,
                        grid: { color: '#f5f5f4' }
                    },
                    x: { display: false }
                }
            }
        });

        // --- GAME ENGINE (CANVAS) ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game Entities
        const player = {
            x: 50,
            y: 250, // Floor level
            width: 30,
            height: 30,
            color: '#3b82f6', // Blue-500
            vy: 0,
            isJumping: false,
            groundY: 250
        };

        const obstacle = {
            x: 600,
            y: 260,
            width: 20,
            height: 20,
            color: '#ef4444', // Red-500
            speed: 3
        };

        // Input Handling
        const keys = {
            right: false,
            left: false,
            space: false
        };

        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') keys.right = true;
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === ' ') {
                keys.space = true;
                e.preventDefault();
                jump();
            }
        });

        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowRight') keys.right = false;
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === ' ') keys.space = false;
        });

        function jump() {
            if (!player.isJumping && gameActive) {
                // Implementing the logic from Step 1B: Set velocity Y to 15
                player.vy = -12; // Negative because Canvas Y is inverted (0 is top)
                player.isJumping = true;
            }
        }

        function updateGame() {
            if (!gameActive) return;

            // 1. Player Movement (Step 1A)
            if (keys.right && player.x < canvas.width - player.width) player.x += 5;
            if (keys.left && player.x > 0) player.x -= 5;

            // 2. Physics (Step 1B Logic)
            player.y += player.vy;
            
            // Gravity Logic: "Sumar a velocidad Y -1.5"
            // In Canvas, down is positive, so we add gravity
            if (player.y < player.groundY) {
                player.vy += 0.6; // Gravity simulation
            } else {
                player.y = player.groundY;
                player.vy = 0;
                player.isJumping = false;
            }

            // 3. Obstacle Logic (Step 2A)
            obstacle.x -= obstacle.speed;
            if (obstacle.x < -20) {
                obstacle.x = canvas.width + Math.random() * 200;
                score++;
                if(obstacle.speed < 8) obstacle.speed += 0.2; // Difficulty ramp
                document.getElementById('score-display').textContent = `Puntos: ${score}`;
            }

            // 4. Collision Detection (Step 2B)
            if (
                player.x < obstacle.x + obstacle.width &&
                player.x + player.width > obstacle.x &&
                player.y < obstacle.y + obstacle.height &&
                player.y + player.height > obstacle.y
            ) {
                gameOver();
            }

            // 5. Update Chart Data
            // We want to visualize height relative to ground (0 to 150)
            const height = player.groundY - player.y;
            const data = physicsChart.data.datasets[0].data;
            data.shift();
            data.push(height);
            physicsChart.update();
        }

        function drawGame() {
            // Clear
            ctx.fillStyle = '#1c1917'; // Stone-900
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ground
            ctx.strokeStyle = '#a8a29e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, player.groundY + player.height);
            ctx.lineTo(canvas.width, player.groundY + player.height);
            ctx.stroke();

            // Player (Cat representation)
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            // Simple eyes
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x + 20, player.y + 5, 5, 5); // Right Eye
            if (keys.left) { // Look left
                ctx.clearRect(player.x + 20, player.y + 5, 5, 5);
                ctx.fillRect(player.x + 5, player.y + 5, 5, 5); 
            }

            // Obstacle
            ctx.fillStyle = obstacle.color;
            ctx.beginPath();
            // Drawing a triangle/rock shape
            ctx.moveTo(obstacle.x, obstacle.y + obstacle.height);
            ctx.lineTo(obstacle.x + obstacle.width / 2, obstacle.y);
            ctx.lineTo(obstacle.x + obstacle.width, obstacle.y + obstacle.height);
            ctx.fill();

            // Game Over Overlay
            if (!gameActive) {
                ctx.fillStyle = 'rgba(0,0,0,0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '30px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('¬°JUEGO TERMINADO!', canvas.width / 2, canvas.height / 2);
                ctx.font = '16px Inter';
                ctx.fillText('Pulsa Reiniciar', canvas.width / 2, canvas.height / 2 + 30);
            }
        }

        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameActive = false;
        }

        function resetGame() {
            gameActive = true;
            player.x = 50;
            player.y = player.groundY;
            player.vy = 0;
            obstacle.x = 600;
            obstacle.speed = 3;
            score = 0;
            document.getElementById('score-display').textContent = `Puntos: 0`;
            
            // Clear chart
            physicsChart.data.datasets[0].data = Array(20).fill(0);
            physicsChart.update();
        }

        // --- UI LOGIC ---
        function setStep(step) {
            currentStep = step;
            
            // Update Buttons
            document.getElementById('btn-step-1').className = step === 1 
                ? "px-4 py-2 rounded-full text-sm font-semibold bg-orange-500 text-white shadow-md transition-all whitespace-nowrap"
                : "px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 hover:bg-stone-300 transition-all whitespace-nowrap";
            
            document.getElementById('btn-step-2').className = step === 2 
                ? "px-4 py-2 rounded-full text-sm font-semibold bg-orange-500 text-white shadow-md transition-all whitespace-nowrap"
                : "px-4 py-2 rounded-full text-sm font-semibold bg-stone-200 text-stone-600 hover:bg-stone-300 transition-all whitespace-nowrap";

            // Update Content with Fade effect
            const contentDiv = document.getElementById('instruction-content');
            const explanationDiv = document.getElementById('logic-explanation');
            
            contentDiv.innerHTML = tutorialData[step].content;
            explanationDiv.textContent = tutorialData[step].explanation;
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- INIT ---
        window.onload = function() {
            setStep(1);
            gameLoop();
        };

    </script>
</body>
</html>