<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva: Mural de la Paz en Scratch</title>
    <script src="/CYR/assets/tailwind.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .scratch-block {
            border-left-width: 4px;
            transition: all 0.3s ease;
        }
        .active-step {
            background-color: #fef3c7; /* amber-100 */
            border-left-color: #d97706; /* amber-600 */
            transform: translateX(10px);
        }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans leading-relaxed">

    <!-- Chosen Palette: Warm Neutrals (Stone/Amber) with Functional Colors (Green for Success, Red for Error, Blue for Logic) -->
    <!-- Application Structure Plan:
         1. Header: Context and Objective.
         2. Simulation Core: A split-screen interactive area. Left side contains the "Controls" (Keys A, X, B, C, Space) and Inputs. Right side contains the "Visual Feedback" (The Mural List, The Blacklist, The Character's Speech). This allows users to "play" the code logic immediately.
         3. Logic Flow Visualization: Below the simulator, a dynamic step-by-step list highlights exactly which part of the code is executing in real-time based on user actions. This teaches the algorithm.
         4. Analytics: A Chart.js bar chart tracks the user's attempts (Successful, Blocked, Transformed) to visualize the effectiveness of the filters.
         5. Step-by-Step Documentation: Static reference content organized by logical task (Setup, Writing, Deleting), updated with insights from the interactive session.
    -->
    <!-- Visualization & Content Choices:
         1. Interactive Lists (HTML/JS): Displays 'Mural de la Paz' and 'Acciones Negativas' to show state changes without SVG. Goal: Organize & Inform.
         2. Dynamic Logic Flow (HTML/CSS Classes): Highlights text blocks to show conditional branching (If/Else) in real-time. Goal: Change/Process Flow.
         3. Action Statistics (Chart.js): Bar chart showing outcomes of user interactions. Goal: Summarize/Compare effectiveness of logic.
         4. Character Feedback (HTML/JS): A speech bubble simulating the Scratch character's output. Goal: Inform/Feedback.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <div class="max-w-6xl mx-auto px-4 py-8">
        
        <!-- Header Section -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-stone-700 mb-4">üïäÔ∏è El Mural de la Paz: Laboratorio de L√≥gica</h1>
            <p class="text-lg text-stone-600 max-w-3xl mx-auto">
                Bienvenido a la gu√≠a interactiva para programar tu proyecto en Scratch. 
                Aqu√≠ no solo leer√°s las instrucciones, sino que <strong>simular√°s el cerebro del programa</strong>. 
                Aprende c√≥mo gestionar listas, aplicar filtros de moderaci√≥n y transformar valores negativos en positivos.
            </p>
        </header>

        <!-- Simulation Section Intro -->
        <section class="mb-6">
            <h2 class="text-2xl font-bold text-stone-700 mb-2">1. Simulador del Proyecto</h2>
            <p class="text-stone-600 mb-4">
                Esta secci√≥n es el coraz√≥n de tu aprendizaje. Utiliza el panel de control a la izquierda para actuar como el usuario del juego. 
                Observa a la derecha c√≥mo reacciona tu "programa" (las listas y el personaje) y debajo c√≥mo se ejecuta la l√≥gica paso a paso.
                Prueba a escribir palabras como "Guerra" u "Odio" para ver el <strong>Transformador</strong> en acci√≥n.
            </p>
        </section>

        <!-- Main Interactive Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-16">
            
            <!-- LEFT COLUMN: Controls & Logic Trace -->
            <div class="lg:col-span-5 flex flex-col gap-6">
                
                <!-- Control Panel -->
                <div class="bg-white p-6 rounded-xl shadow-md border border-stone-200">
                    <h3 class="font-bold text-xl text-indigo-600 mb-4">üéÆ Controles (Teclado Virtual)</h3>
                    
                    <div class="space-y-4">
                        <!-- Input for Message -->
                        <div>
                            <label class="block text-sm font-semibold text-stone-500 mb-1">Entrada de Usuario:</label>
                            <input type="text" id="userInput" placeholder="Escribe un mensaje aqu√≠..." class="w-full p-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-indigo-300 outline-none transition" onkeypress="handleEnter(event)">
                        </div>

                        <!-- Action Buttons -->
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="pressKeyA()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                                <span>[ A ]</span> Escribir
                            </button>
                            <button onclick="pressKeyX()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                                <span>[ X ]</span> Borrar
                            </button>
                            <button onclick="pressKeyC()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                                <span>[ C ]</span> Limpiar
                            </button>
                            <button onclick="pressKeySpace()" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                                <span>[ Espacio ]</span> Contar
                            </button>
                        </div>
                        <button onclick="pressKeyB()" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow transition flex items-center justify-center gap-2">
                            <span>[ B ]</span> Detector de Valores (Scan)
                        </button>
                    </div>
                </div>

                <!-- Logic Flow Visualizer -->
                <div class="bg-stone-100 p-6 rounded-xl border border-stone-200 flex-grow">
                    <h3 class="font-bold text-lg text-stone-700 mb-3">üß† Flujo L√≥gico en Tiempo Real</h3>
                    <div id="logicTrace" class="space-y-2 text-sm font-mono bg-white p-4 rounded border border-stone-200 h-64 overflow-y-auto">
                        <p class="text-stone-400 italic">Esperando interacci√≥n...</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: Visualization & Data -->
            <div class="lg:col-span-7 flex flex-col gap-6">
                
                <!-- The "Stage" (Visual Output) -->
                <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 relative min-h-[160px] flex flex-col items-center justify-center text-center">
                    <div class="text-6xl mb-4">üïäÔ∏è</div>
                    <div id="characterSpeech" class="bg-white p-4 rounded-2xl shadow-lg border-2 border-indigo-200 text-indigo-900 font-medium max-w-md relative">
                        "¬°Hola! Pulsa 'A' para a√±adir un mensaje al Mural de la Paz."
                        <div class="absolute w-4 h-4 bg-white border-b-2 border-r-2 border-indigo-200 transform rotate-45 -bottom-2 left-1/2 -translate-x-1/2"></div>
                    </div>
                </div>

                <!-- Data Lists Container -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Mural List -->
                    <div class="bg-white p-4 rounded-lg shadow border-2 border-blue-100">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-blue-800">üìú Mural de la Paz</h4>
                            <span id="muralCount" class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">0/8</span>
                        </div>
                        <ul id="muralListDisplay" class="space-y-1 h-40 overflow-y-auto text-sm text-stone-700">
                            <!-- Items will be injected here -->
                            <li class="text-stone-400 italic text-xs p-2">Vac√≠o...</li>
                        </ul>
                    </div>

                    <!-- Negative Actions List -->
                    <div class="bg-white p-4 rounded-lg shadow border-2 border-red-100">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-red-800">üö´ Lista Negra (Oculta)</h4>
                            <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">Filtro Activo</span>
                        </div>
                        <ul id="negativeListDisplay" class="space-y-1 h-40 overflow-y-auto text-sm text-stone-700 opacity-75">
                            <!-- Items injected by JS -->
                        </ul>
                    </div>
                </div>

                <!-- Analytics Chart -->
                <div class="bg-white p-6 rounded-xl shadow-md border border-stone-200">
                    <h3 class="font-bold text-lg text-stone-700 mb-2">üìä An√°lisis de Moderaci√≥n</h3>
                    <p class="text-xs text-stone-500 mb-4">Resultados de tus interacciones con el algoritmo.</p>
                    
                    <div class="chart-container">
                        <canvas id="statsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Educational Content Section -->
        <section class="bg-white rounded-2xl shadow-xl p-8 border-t-8 border-indigo-500">
            <h2 class="text-3xl font-bold text-stone-800 mb-6">Gu√≠a de Implementaci√≥n Paso a Paso</h2>
            <p class="text-stone-600 mb-8">
                A continuaci√≥n encontrar√°s el desglose te√≥rico de lo que acabas de experimentar en el simulador. 
                Utiliza estos bloques de referencia para construir tu proyecto real en Scratch.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                
                <!-- Step 1 & 2 -->
                <div class="space-y-8">
                    <article class="prose prose-stone">
                        <h3 class="text-xl font-bold text-indigo-600 flex items-center gap-2">
                            <span class="bg-indigo-100 text-indigo-700 w-8 h-8 rounded-full flex items-center justify-center text-sm">1</span>
                            Configuraci√≥n Inicial
                        </h3>
                        <p>Antes de empezar, necesitamos nuestros contenedores de datos.</p>
                        <ul class="list-disc pl-5 space-y-2 text-sm">
                            <li>Crea la lista <strong>Mural de la Paz</strong> (Visible).</li>
                            <li>Crea la lista <strong>Acciones Negativas</strong> (Oculta).</li>
                            <li><strong>Al presionar Bandera Verde:</strong> Inicializa la lista negativa con palabras prohibidas (Guerra, Odio, etc.) para asegurar que el filtro funcione desde el inicio.</li>
                        </ul>
                    </article>

                    <article class="prose prose-stone">
                        <h3 class="text-xl font-bold text-indigo-600 flex items-center gap-2">
                            <span class="bg-indigo-100 text-indigo-700 w-8 h-8 rounded-full flex items-center justify-center text-sm">2</span>
                            L√≥gica de Escritura (Tecla A)
                        </h3>
                        <p>Este es el cerebro del mural. Sigue este orden de chequeo:</p>
                        <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-blue-400 text-sm font-mono">
                            SI (respuesta = "Guerra") ENTONCES<br>
                            &nbsp;&nbsp;Transformar a "Paz"<br>
                            SI NO, SI (ListaNegativa contiene respuesta) ENTONCES<br>
                            &nbsp;&nbsp;Error: "Palabra no permitida"<br>
                            SI NO, SI (Longitud Mural < 8) ENTONCES<br>
                            &nbsp;&nbsp;A√±adir a Mural<br>
                            SI NO<br>
                            &nbsp;&nbsp;Error: "Mural Lleno"
                        </div>
                    </article>
                </div>

                <!-- Step 3, 4 & 5 -->
                <div class="space-y-8">
                    <article class="prose prose-stone">
                        <h3 class="text-xl font-bold text-indigo-600 flex items-center gap-2">
                            <span class="bg-indigo-100 text-indigo-700 w-8 h-8 rounded-full flex items-center justify-center text-sm">3</span>
                            Gesti√≥n y Limpieza (Teclas X, C, Espacio)
                        </h3>
                        <p>Herramientas para mantener el mural ordenado.</p>
                        <ul class="list-disc pl-5 space-y-2 text-sm">
                            <li><strong>Tecla X (Borrar):</strong> Pide un n√∫mero y usa el bloque <code>eliminar (respuesta) de Mural</code>.</li>
                            <li><strong>Tecla C (Limpiar):</strong> Usa el bloque <code>eliminar todos de Mural</code> para reiniciar.</li>
                            <li><strong>Espacio (Contar):</strong> Usa el bloque operador <code>unir</code> para combinar texto con el bloque <code>longitud de Mural</code>.</li>
                        </ul>
                    </article>

                    <article class="prose prose-stone">
                        <h3 class="text-xl font-bold text-emerald-600 flex items-center gap-2">
                            <span class="bg-emerald-100 text-emerald-700 w-8 h-8 rounded-full flex items-center justify-center text-sm">4</span>
                            Detector de Valores (Tecla B)
                        </h3>
                        <p>Un bucle de auditor√≠a para seguridad extra.</p>
                        <div class="bg-stone-50 p-4 rounded-lg border-l-4 border-emerald-400 text-sm font-mono">
                            Fijar variable [√≠ndice] a 1<br>
                            REPETIR (longitud de Mural) veces<br>
                            &nbsp;&nbsp;SI (ListaNegativa contiene item [√≠ndice])<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;Alertar "Conflicto detectado"<br>
                            &nbsp;&nbsp;Cambiar [√≠ndice] por 1
                        </div>
                    </article>
                </div>

            </div>
        </section>

        <footer class="text-center mt-12 text-stone-400 text-sm pb-8">
            <p>Generado a partir de la Gu√≠a del Mural de la Paz. Dise√±ado para el aprendizaje interactivo.</p>
        </footer>

    </div>

    <!-- Application Logic -->
    <script>
        // --- DATA STATE ---
        const gameState = {
            mural: [],
            negativeList: ["Guerra", "Odio", "Insulto", "Pelea", "Violencia"],
            maxMuralSize: 8,
            stats: {
                added: 0,
                blocked: 0,
                transformed: 0,
                deleted: 0
            }
        };

        // --- CHART INITIALIZATION ---
        let statsChart;

        function initChart() {
            const ctx = document.getElementById('statsChart').getContext('2d');
            statsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Aceptados', 'Bloqueados', 'Transformados', 'Borrados'],
                    datasets: [{
                        label: 'Interacciones',
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.6)',  // Green - Accepted
                            'rgba(239, 68, 68, 0.6)',  // Red - Blocked
                            'rgba(234, 179, 8, 0.6)',  // Yellow - Transformed
                            'rgba(107, 114, 128, 0.6)' // Gray - Deleted
                        ],
                        borderColor: [
                            'rgb(34, 197, 94)',
                            'rgb(239, 68, 68)',
                            'rgb(234, 179, 8)',
                            'rgb(107, 114, 128)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // --- UI UPDATE FUNCTIONS ---

        function updateUI() {
            // Update Mural List
            const muralListEl = document.getElementById('muralListDisplay');
            const countEl = document.getElementById('muralCount');
            
            muralListEl.innerHTML = '';
            if (gameState.mural.length === 0) {
                muralListEl.innerHTML = '<li class="text-stone-400 italic text-xs p-2">Vac√≠o...</li>';
            } else {
                gameState.mural.forEach((msg, index) => {
                    const li = document.createElement('li');
                    li.className = 'p-2 bg-blue-50 rounded border border-blue-100 text-blue-900 flex justify-between animate-[fadeIn_0.3s_ease-out]';
                    li.innerHTML = `<span>${index + 1}. ${msg}</span>`;
                    muralListEl.appendChild(li);
                });
            }
            countEl.textContent = `${gameState.mural.length}/${gameState.maxMuralSize}`;

            // Update Chart
            statsChart.data.datasets[0].data = [
                gameState.stats.added,
                gameState.stats.blocked,
                gameState.stats.transformed,
                gameState.stats.deleted
            ];
            statsChart.update();
        }

        function initNegativeList() {
            const listEl = document.getElementById('negativeListDisplay');
            listEl.innerHTML = '';
            gameState.negativeList.forEach(word => {
                const li = document.createElement('li');
                li.className = 'px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100 inline-block mr-1 mb-1';
                li.textContent = word;
                listEl.appendChild(li);
            });
        }

        function setCharacterSpeech(text, type = 'neutral') {
            const bubble = document.getElementById('characterSpeech');
            bubble.textContent = text;
            
            // Reset classes
            bubble.className = 'p-4 rounded-2xl shadow-lg border-2 max-w-md relative transition-colors duration-300';
            
            if (type === 'error') {
                bubble.classList.add('bg-red-50', 'border-red-200', 'text-red-900');
            } else if (type === 'success') {
                bubble.classList.add('bg-green-50', 'border-green-200', 'text-green-900');
            } else if (type === 'magic') {
                bubble.classList.add('bg-yellow-50', 'border-yellow-200', 'text-yellow-900');
            } else {
                bubble.classList.add('bg-white', 'border-indigo-200', 'text-indigo-900');
            }
            
            // Re-add tail
            const tail = document.createElement('div');
            tail.className = `absolute w-4 h-4 border-b-2 border-r-2 transform rotate-45 -bottom-2 left-1/2 -translate-x-1/2 ${type === 'error' ? 'bg-red-50 border-red-200' : type === 'success' ? 'bg-green-50 border-green-200' : type === 'magic' ? 'bg-yellow-50 border-yellow-200' : 'bg-white border-indigo-200'}`;
            bubble.appendChild(tail);
        }

        function logTrace(message, type = 'info') {
            const traceContainer = document.getElementById('logicTrace');
            const p = document.createElement('p');
            p.className = `scratch-block p-2 rounded mb-1 text-xs ${type === 'cmd' ? 'bg-yellow-50 border-yellow-400' : type === 'check' ? 'bg-blue-50 border-blue-400' : type === 'result' ? 'bg-stone-50 border-stone-400 font-bold' : ''}`;
            p.textContent = `> ${message}`;
            traceContainer.prepend(p);
        }

        function getInput() {
            const input = document.getElementById('userInput');
            const val = input.value.trim();
            input.value = '';
            return val;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') pressKeyA();
        }

        // --- GAME LOGIC FUNCTIONS ---

        function pressKeyA() {
            const input = getInput();
            if (!input) {
                setCharacterSpeech("Por favor, escribe un mensaje primero.", "neutral");
                return;
            }

            logTrace(`Tecla A presionada con: "${input}"`, 'cmd');

            // 1. Transformer Logic
            let finalMessage = input;
            let wasTransformed = false;
            
            // Normalizing for case-insensitive check
            const inputLower = input.toLowerCase();

            if (inputLower === 'guerra') {
                logTrace(`‚ö° Transformador Activado: Guerra -> Paz`, 'check');
                finalMessage = "Paz";
                wasTransformed = true;
            } else if (inputLower === 'odio') {
                logTrace(`‚ö° Transformador Activado: Odio -> Amor`, 'check');
                finalMessage = "Amor";
                wasTransformed = true;
            }

            // 2. Negative Filter Logic
            // Check if any word in the negative list is in the input (simple includes check)
            const isNegative = gameState.negativeList.some(badWord => finalMessage.toLowerCase().includes(badWord.toLowerCase()));

            if (isNegative) {
                logTrace(`‚ùå Filtro: "${finalMessage}" detectado en Lista Negra`, 'check');
                setCharacterSpeech("¬°Esa palabra no construye paz! Intenta con algo positivo.", "error");
                gameState.stats.blocked++;
            } else {
                // 3. Space Logic
                if (gameState.mural.length < gameState.maxMuralSize) {
                    gameState.mural.push(finalMessage);
                    
                    if (wasTransformed) {
                        setCharacterSpeech(`¬°Magia! He cambiado tu mensaje negativo por "${finalMessage}" y lo he a√±adido.`, "magic");
                        gameState.stats.transformed++;
                    } else {
                        setCharacterSpeech(`¬°Mensaje "${finalMessage}" a√±adido con √©xito!`, "success");
                        gameState.stats.added++;
                    }
                    logTrace(`‚úÖ Mensaje "${finalMessage}" a√±adido al √≠ndice ${gameState.mural.length}`, 'result');
                } else {
                    logTrace(`‚ö†Ô∏è Filtro: Mural lleno (${gameState.mural.length}/8)`, 'check');
                    setCharacterSpeech("¬°El mural est√° completo! Debes quitar un mensaje viejo.", "error");
                }
            }
            updateUI();
        }

        function pressKeyX() {
            if (gameState.mural.length === 0) {
                setCharacterSpeech("El mural ya est√° vac√≠o.", "neutral");
                return;
            }

            // Simulate asking for number (Prompt)
            // For UI simplicity, we'll try to get it from input box, or prompt user
            let indexStr = prompt(`¬øQu√© n√∫mero de mensaje quieres retirar? (1-${gameState.mural.length})`);
            
            if (indexStr) {
                const index = parseInt(indexStr);
                if (index > 0 && index <= gameState.mural.length) {
                    const removed = gameState.mural.splice(index - 1, 1);
                    logTrace(`üóëÔ∏è Elemento ${index} ("${removed}") eliminado`, 'cmd');
                    setCharacterSpeech(`He retirado el mensaje: "${removed}"`, "neutral");
                    gameState.stats.deleted++;
                } else {
                    logTrace(`‚ö†Ô∏è Intento de borrar √≠ndice inv√°lido: ${indexStr}`, 'check');
                    setCharacterSpeech("Ese n√∫mero no existe en el mural.", "error");
                }
            }
            updateUI();
        }

        function pressKeyC() {
            if (confirm("¬øSeguro que quieres borrar TODO el mural?")) {
                const count = gameState.mural.length;
                gameState.mural = [];
                logTrace(`üßπ Mural limpiado (${count} mensajes borrados)`, 'cmd');
                setCharacterSpeech("El mural est√° listo para nuevas ideas.", "neutral");
                gameState.stats.deleted += count;
                updateUI();
            }
        }

        function pressKeySpace() {
            const msg = `Tenemos ${gameState.mural.length} mensajes de paz.`;
            logTrace(`‚ÑπÔ∏è Contando mensajes: ${gameState.mural.length}`, 'cmd');
            setCharacterSpeech(msg, "neutral");
        }

        function pressKeyB() {
            logTrace(`üîç Iniciando Escaneo de Valores...`, 'cmd');
            let foundConflict = false;
            
            // Simulation of the loop logic
            gameState.mural.forEach((msg, idx) => {
                const isNegative = gameState.negativeList.some(badWord => msg.toLowerCase().includes(badWord.toLowerCase()));
                if (isNegative) {
                    logTrace(`‚ö†Ô∏è Conflicto encontrado en pos ${idx + 1}: "${msg}"`, 'check');
                    foundConflict = true;
                }
            });

            if (foundConflict) {
                setCharacterSpeech("¬°Atenci√≥n! He detectado un conflicto en el mural.", "error");
            } else {
                logTrace(`‚úÖ Escaneo completado. Todo limpio.`, 'result');
                setCharacterSpeech("He analizado el mural y todo parece correcto.", "success");
            }
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            initChart();
            initNegativeList();
            updateUI();
            logTrace("Sistema iniciado. Reglas cargadas.", 'result');
        };

    </script>
</body>
</html>